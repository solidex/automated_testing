---
  - name: "Get lldp neighbors"
    nclu:
      commands:
        - show lldp json
    register: lldp_json

  - name: "Save output for further analysis"
    set_fact: result="{{ lldp_json.msg }}"

### append runtime neighbor to dictionary 
  - name: "Form dictionary of runtime lldp neighbors"
    set_fact:
       runtime_lldp_neighbors: '{{runtime_lldp_neighbors |
       combine({item.name: item.chassis[0].name[0].value})}}'
### loop through output "interfaces" array,
### select "name" value from each interface, which is
### actual neighbor name
    loop: "{{ result | json_query('lldp[0].interface[*]') }}"
